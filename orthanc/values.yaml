# Default values for orthanc.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: osimis/orthanc 
  pullPolicy: Always 
  tag: "23.11.1" 

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: "orth-service"

podAnnotations: {}

podSecurityContext:
  # fsGroup: 2000
  seccompProfile:
    type: RuntimeDefault

securityContext:
  capabilities: {}
    # drop:
    # - ALL
    # add:
    # - DAC_OVERRIDE
  allowPrivilegeEscalation: false
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

service:
  type: ClusterIP 
  httpPort: 8042
  dicomPort: 4242 

resources:
  # We usually recommend not to specify default resources and to leave this as a conscious
  # choice for the user. This also increases chances charts run on environments with little
  # resources, such as Minikube. If you do want to specify resources, uncomment the following
  # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
  limits:
    # cpu: 100m # Do not set CPU limit
    # memory: 128Mi
  requests:
    cpu: 100m
    memory: 128Mi

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 5
  targetCPUUtilizationPercentage: 85
  targetMemoryUtilizationPercentage: 85

nodeSelector: {}

tolerations: []

affinity: {}

postgresSecret:
  address: 
    name: 'pg-connection-secret'
    key: 'address'
  database: 
    name: 'pg-connection-secret'
    key: 'database'
  username: 
    name: 'pg-connection-secret'
    key: 'username'
  password: 
    name: 'pg-connection-secret'
    key: 'password'
  port:
    name: 'pg-connection-secret'
    key: 'port'


## app configuration 
catls:
  secretName: ca-secret
  caCommonName: ca.orthweb.com
dbtls:
  secretName: dbtls-secret
  certCommonName: db.orthweb.com
dcmtls:
  secretName: dcmtls-secret
  certCommonName: dicom.orthweb.com
https:
  secretName: https-secret
  certCommonName: web.orthweb.com

# not recommended to modify PostgreSQL connection variables through here
# connection variables are sourced through the secret(s) defined above in postgresSecret
orthancJson: |
  {  
    "Name" : "Orthanc",
    "RemoteAccessAllowed" : true,
    "SslEnabled" : false,
    "AuthenticationEnabled" : true,
    "RegisteredUsers" : {
      "admin" : "orthanc"
    },
    "DicomTlsEnabled" : false,
    "DicomTlsRemoteCertificateRequired" : false,
    "PostgreSQL" : {
      "EnableIndex" : true,
      "EnableStorage" : true,
      "Host" : "${DB_ADDR}",
      "Port" : "${DB_PORT}",
      "Database" : "${DB_DBNAME}",
      "Username" : "${DB_USERNAME}",
      "Password" : "${DB_PASSWORD}",
      "EnableSsl" : true,
      "Lock" : false
    },
    "Plugins" : [
      "/usr/share/orthanc/plugins-available/libOrthancPostgreSQLIndex.so",
      "/usr/share/orthanc/plugins-available/libOrthancPostgreSQLStorage.so",
      "/usr/share/orthanc/plugins-available/libOrthancWebViewer.so"
    ]
  }
